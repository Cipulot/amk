/**
 * @file ms_8xv3.c
 */

#include "ms_8xv3.h"
#include "amk_printf.h"

#ifdef RGB_ENABLE
#include "rgb_common.h"
#include "rgb_driver.h"
#include "rgb_linear.h"
#include "rgb_matrix_stub.h"
#include "is31fl3236.h"
#include "is31fl3729.h"

rgb_led_t g_rgb_leds[RGB_LED_NUM] = {
    {0, CS14_SW1_29, CS13_SW1_29, CS15_SW1_29},
    {0, CS14_SW2_29, CS13_SW2_29, CS15_SW2_29},
    {0, CS14_SW3_29, CS13_SW3_29, CS15_SW3_29},
    {0, CS14_SW4_29, CS13_SW4_29, CS15_SW4_29},
    {0, CS14_SW5_29, CS13_SW5_29, CS15_SW5_29},
    {0, CS14_SW6_29, CS13_SW6_29, CS15_SW6_29},
    {0, CS14_SW7_29, CS13_SW7_29, CS15_SW7_29},
    {0, CS14_SW8_29, CS13_SW8_29, CS15_SW8_29},
    {0, CS14_SW9_29, CS13_SW9_29, CS15_SW9_29},

    {0, CS11_SW1_29, CS10_SW1_29, CS12_SW1_29},
    {0, CS11_SW2_29, CS10_SW2_29, CS12_SW2_29},
    {0, CS11_SW3_29, CS10_SW3_29, CS12_SW3_29},
    {0, CS11_SW4_29, CS10_SW4_29, CS12_SW4_29},
    {0, CS11_SW5_29, CS10_SW5_29, CS12_SW5_29},
    {0, CS11_SW6_29, CS10_SW6_29, CS12_SW6_29},
    {0, CS11_SW7_29, CS10_SW7_29, CS12_SW7_29},
    {0, CS11_SW8_29, CS10_SW8_29, CS12_SW8_29},
    {0, CS11_SW9_29, CS10_SW9_29, CS12_SW9_29},

    {0, CS8_SW1_29, CS7_SW1_29, CS9_SW1_29},
    {0, CS8_SW2_29, CS7_SW2_29, CS9_SW2_29},
    {0, CS8_SW3_29, CS7_SW3_29, CS9_SW3_29},
    {0, CS8_SW4_29, CS7_SW4_29, CS9_SW4_29},
    {0, CS8_SW5_29, CS7_SW5_29, CS9_SW5_29},
    {0, CS8_SW6_29, CS7_SW6_29, CS9_SW6_29},
    {0, CS8_SW7_29, CS7_SW7_29, CS9_SW7_29},
    {0, CS8_SW8_29, CS7_SW8_29, CS9_SW8_29},
    {0, CS8_SW9_29, CS7_SW9_29, CS9_SW9_29},

    {0,  CS5_SW1_29,  CS4_SW1_29,  CS6_SW1_29},
    {0,  CS5_SW2_29,  CS4_SW2_29,  CS6_SW2_29},
    {0,  CS5_SW3_29,  CS4_SW3_29,  CS6_SW3_29},
    {0,  CS5_SW4_29,  CS4_SW4_29,  CS6_SW4_29},
    {0,  CS5_SW5_29,  CS4_SW5_29,  CS6_SW5_29},
    {0,  CS5_SW6_29,  CS4_SW6_29,  CS6_SW6_29},
    {0,  CS5_SW7_29,  CS4_SW7_29,  CS6_SW7_29},
    {0,  CS5_SW8_29,  CS4_SW8_29,  CS6_SW8_29},
    {0,  CS5_SW9_29,  CS4_SW9_29,  CS6_SW9_29},

    {0,  CS2_SW1_29,  CS1_SW1_29,  CS3_SW1_29},
    {0,  CS2_SW2_29,  CS1_SW2_29,  CS3_SW2_29},
    {0,  CS2_SW3_29,  CS1_SW3_29,  CS3_SW3_29},
    {0,  CS2_SW4_29,  CS1_SW4_29,  CS3_SW4_29},
    {0,  CS2_SW5_29,  CS1_SW5_29,  CS3_SW5_29},
    {0,  CS2_SW6_29,  CS1_SW6_29,  CS3_SW6_29},
    {0,  CS2_SW7_29,  CS1_SW7_29,  CS3_SW7_29},
    {0,  CS2_SW8_29,  CS1_SW8_29,  CS3_SW8_29},
    {0,  CS2_SW9_29,  CS1_SW9_29,  CS3_SW9_29},

    // right
    {1,  CS2_SW1_29,  CS1_SW1_29,  CS3_SW1_29},
    {1,  CS2_SW2_29,  CS1_SW2_29,  CS3_SW2_29},
    {1,  CS2_SW3_29,  CS1_SW3_29,  CS3_SW3_29},
    {1,  CS2_SW4_29,  CS1_SW4_29,  CS3_SW4_29},
    {1,  CS2_SW5_29,  CS1_SW5_29,  CS3_SW5_29},
    {1,  CS2_SW6_29,  CS1_SW6_29,  CS3_SW6_29},
    {1,  CS2_SW7_29,  CS1_SW7_29,  CS3_SW7_29},
    {1,  CS2_SW8_29,  CS1_SW8_29,  CS3_SW8_29},
    {1,  CS2_SW9_29,  CS1_SW9_29,  CS3_SW9_29},

    {1,  CS5_SW1_29,  CS4_SW1_29,  CS6_SW1_29},
    {1,  CS5_SW2_29,  CS4_SW2_29,  CS6_SW2_29},
    {1,  CS5_SW3_29,  CS4_SW3_29,  CS6_SW3_29},
    {1,  CS5_SW4_29,  CS4_SW4_29,  CS6_SW4_29},
    {1,  CS5_SW5_29,  CS4_SW5_29,  CS6_SW5_29},
    {1,  CS5_SW6_29,  CS4_SW6_29,  CS6_SW6_29},
    {1,  CS5_SW7_29,  CS4_SW7_29,  CS6_SW7_29},
    {1,  CS5_SW8_29,  CS4_SW8_29,  CS6_SW8_29},
    {1,  CS5_SW9_29,  CS4_SW9_29,  CS6_SW9_29},

    {1, CS8_SW1_29, CS7_SW1_29, CS9_SW1_29},
    {1, CS8_SW2_29, CS7_SW2_29, CS9_SW2_29},
    {1, CS8_SW3_29, CS7_SW3_29, CS9_SW3_29},
    {1, CS8_SW4_29, CS7_SW4_29, CS9_SW4_29},
    {1, CS8_SW5_29, CS7_SW5_29, CS9_SW5_29},
    {1, CS8_SW6_29, CS7_SW6_29, CS9_SW6_29},
    {1, CS8_SW7_29, CS7_SW7_29, CS9_SW7_29},
    {1, CS8_SW8_29, CS7_SW8_29, CS9_SW8_29},
    {1, CS8_SW9_29, CS7_SW9_29, CS9_SW9_29},

    {1, CS11_SW1_29, CS10_SW1_29, CS12_SW1_29},
    {1, CS11_SW2_29, CS10_SW2_29, CS12_SW2_29},
    {1, CS11_SW3_29, CS10_SW3_29, CS12_SW3_29},
    {1, CS11_SW4_29, CS10_SW4_29, CS12_SW4_29},
    {1, CS11_SW5_29, CS10_SW5_29, CS12_SW5_29},
    {1, CS11_SW6_29, CS10_SW6_29, CS12_SW6_29},
    {1, CS11_SW7_29, CS10_SW7_29, CS12_SW7_29},
    {1, CS11_SW8_29, CS10_SW8_29, CS12_SW8_29},
    {1, CS11_SW9_29, CS10_SW9_29, CS12_SW9_29},

    {1, CS14_SW1_29, CS13_SW1_29, CS15_SW1_29},
    {1, CS14_SW2_29, CS13_SW2_29, CS15_SW2_29},
    {1, CS14_SW3_29, CS13_SW3_29, CS15_SW3_29},
    {1, CS14_SW4_29, CS13_SW4_29, CS15_SW4_29},
    {1, CS14_SW5_29, CS13_SW5_29, CS15_SW5_29},
    {1, CS14_SW6_29, CS13_SW6_29, CS15_SW6_29},
    {1, CS14_SW7_29, CS13_SW7_29, CS15_SW7_29},
    {1, CS14_SW8_29, CS13_SW8_29, CS15_SW8_29},
    {1, CS14_SW9_29, CS13_SW9_29, CS15_SW9_29},
    // 6 leds
    {2, OUT_24, OUT_23, OUT_22},
    {2, OUT_21, OUT_20, OUT_19},
    {2, OUT_18, OUT_17, OUT_16},
    {2, OUT_15, OUT_14, OUT_13},
    {2, OUT_12, OUT_11, OUT_10},
    {2,  OUT_9,  OUT_8,  OUT_7},

    // 7 leds
    {3,0,0,0},
    {3,1,1,1},
    {3,2,2,2},
    {3,3,3,3},
    {3,4,4,4},
    {3,5,5,5},
    {3,6,6,6},
};

rgb_device_t g_rgb_devices[RGB_DEVICE_NUM] = {
    {RGB_DRIVER_IS31FL3729, 0x68, 0, 0, 45},
    {RGB_DRIVER_IS31FL3729, 0x6E, 1, 45, 45},
    {RGB_DRIVER_IS31FL3236, 0x78, 0, 90, 6},
    {RGB_DRIVER_WS2812,     0, 0, 96, 7},
};

rgb_param_t g_rgb_matrix_params[RGB_MATRIX_NUM] = {
    {0, 0, 90},
};

rgb_param_t g_rgb_linear_params[RGB_SEGMENT_NUM] = {
    {1,  90, 3},
    {2,  93, 3},
    {1,  96, 7},
};

led_config_t g_led_config = {
    {
        {    45,    46, 57,     58,     59,     60, 61, NO_LED,     49,     50,     51, 52,     53,     47,     48},
        {     7,     0,  1,      2,      3,      4,  5,      6,     15,     24,     25, 16,     26,     17,      8},
        {    63,    64, 65,     66,     27,     28, 29,     30,     68,     69,     70, 54,     55,     56,     67},
        {NO_LED,    71, 18,     19,     20,     21, 22,     23,     12,     13,     14, 62,      9,     10,     11},
        {    37,    38, 81,     39,     40,     41, 42,     43,     76,     72,     73, 77,     74,     78,     36},
        {    83,    84, 85,     86,     87,     88, 89,     44,     35,     31,     32, 33,     34, NO_LED, NO_LED},
    },
    {
         {110,0}, {123,0}, {142,0}, {155,0}, {168,0}, {181,0}, {198,0}, {211,0},{224,0},
        {104,16},{116,16},{129,16},{142,16},{155,16},{175,16},{198,16},{211,16},{224,16},
        {110,28},{123,28},{136,28},{149,28},{162,28},{178,28},{198,28},{211,28},{224,28},
         {61,40}, {74,40}, {87,40},{100,40},{113,40},{126,40},{139,40},{152,40},{173,40},
         {55,52}, {68,52}, {81,52}, {94,52},{107,52},{120,52},{133,52},{146,52},{170,52},

         {0,16}, {13,16},   {0,0},  {26,0},  {39,0},  {52,0},  {65,0},  {84,0},  {97,0},
         {3,28}, {19,28}, {32,28}, {26,16}, {39,16}, {52,16}, {65,16}, {78,16}, {91,16},
         {2,40}, {23,40}, {36,40}, {49,40}, {45,28}, {58,28}, {71,28}, {84,28}, {97,28},
         {3,64}, {19,64}, {36,64}, {52,61},  {8,52}, {29,52}, {42,52}, {72,61},{110,61},
        {91,64},{129,61},{146,64},{162,64},{178,64},{198,64},{211,64},{224,64},{211,52},
    },
    {
        1, 1, 1, 1, 1, 1, 1, 1, 1,
        4, 4, 4, 4, 4, 1, 1, 1, 1,
        4, 4, 4, 4, 4, 4, 1, 1, 1,
        4, 4, 4, 4, 4, 4, 4, 4, 1,
        4, 4, 4, 4, 4, 4, 4, 4, 1,

        4, 4, 1, 1, 1, 1, 1, 1, 1,
        1, 4, 4, 4, 4, 4, 4, 4, 4,
        1, 4, 4, 4, 4, 4, 4, 4, 4,
        1, 1, 1, 4, 1, 4, 4, 4, 4,
        4, 4, 4, 1, 1, 1, 1, 1, 1,
    },
};

#define CAPS_LED_INDEX 63

void rgb_led_pre_flush(void)
{
    if (!rgb_matrix_is_enabled()) {
        if (host_keyboard_led_state().caps_lock) {
            rgb_matrix_set_rgb_stub(0, CAPS_LED_INDEX, 0xFF, 0xFF, 0xFF);
        } else {
            rgb_matrix_set_rgb_stub(0, CAPS_LED_INDEX, 0, 0, 0);
        }
    }
}
#endif